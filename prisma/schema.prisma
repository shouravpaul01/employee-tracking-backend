generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

model User {
  id     String     @id @default(auto()) @map("_id") @db.ObjectId
  name   String
  email  String     @unique
  phone  String?
  photo  String?
  role   UserRole   @default(EMPLOYEE)
  status UserStatus @default(ACTIVE)

  isDeleted Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  assignedEmployees AssignedEmployee[]
  credential        Credential?

  @@map("users")
}

model Credential {
  id          String    @id @default(auto()) @map("_id") @db.ObjectId
  password    String
  otp         String?
  otpExpireAt DateTime?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  userId String @unique @db.ObjectId
  user   User   @relation(fields: [userId], references: [id])

  @@map("credentials")
}

model Project {
  id         String @id @default(auto()) @map("_id") @db.ObjectId
  name       String
  clientName String

  propertyAddress String
  accessInfo      String?
  notes           String?
  status          ProjectStatus

  lastWorkingDate   DateTime
  createdAt         DateTime           @default(now())
  updatedAt         DateTime           @updatedAt
  expenses          Expenses[]
  assignedEmployees AssignedEmployee[]

  @@map("projects")
}

model AssignedEmployee {
  id             String               @id @default(auto()) @map("_id") @db.ObjectId
  role           AssignedEmployeeRole
  checkIn        DateTime?
  checkOut       DateTime?
  breakTimeStart DateTime?
  breakTimeEnd   DateTime?
  status         AttendanceStatus     @default(NOT_STARTED)
  projectId      String               @db.ObjectId
  project        Project              @relation(fields: [projectId], references: [id])
  employeeId     String               @db.ObjectId
  employee       User                 @relation(fields: [employeeId], references: [id])
  createdAt      DateTime             @default(now())
  updatedAt      DateTime             @updatedAt

  @@index([createdAt])
  @@map("assigned_employees")
}

model Expenses {
  id              String         @id @default(auto()) @map("_id") @db.ObjectId
  category        String
  projectId       String         @db.ObjectId
  project         Project        @relation(fields: [projectId], references: [id])
  amount          Float
  description     String?
  receiptDocImage String?
  status          ExpensesStatus
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt

  @@map("expenses")
}

enum ExpensesStatus {
  PENDING
  APPROVED
  REJECTED
}

enum AttendanceStatus {
  NOT_STARTED
  CHECKED_IN
  ON_BREAK
  BREAK_ENDED
  CHECKED_OUT
}

enum AssignedEmployeeRole {
  RUNNER
  PICKER
}

enum ProjectStatus {
  STAGING
  WALKTHROUGH
  DESTAGING
  COMPLETED
}

enum UserRole {
  ADMIN
  EMPLOYEE
}

enum UserStatus {
  ACTIVE
  BLOCKED
}
