generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

model User {
  id     String     @id @default(auto()) @map("_id") @db.ObjectId
  name   String
  email  String     @unique
  phone  String?    @unique
  photo  String?
  role   UserRole
  status UserStatus @default(ACTIVE)

  isDeleted         Boolean            @default(false)
  createdAt         DateTime           @default(now())
  updatedAt         DateTime           @updatedAt
  credentials       Credential[]
  assignedEmployees AssignedEmployee[]

  @@map("users")
}

model Credential {
  id          String    @id @default(auto()) @map("_id") @db.ObjectId
  password    String
  otp         String?
  otpExpireAt DateTime?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  userId      String    @db.ObjectId
  user        User      @relation(fields: [userId], references: [id])

  @@map("Credentials")
}

model Project {
  id              String        @id @default(auto()) @map("_id") @db.ObjectId
  name            String
  clientName      String
  propertyAddress String
  accessInfo      String?
  notes           String?
  status          ProjectStatus

  lastWorkingDate DateTime
  createdAt       DateTime   @default(now())
  updatedAt       DateTime   @updatedAt
  expenses        Expenses[]

  @@map("projects")
}

model AssignedEmployee {
  id             String               @id @default(auto()) @map("_id") @db.ObjectId
  role           AssignedEmployeeRole
  checkIn        DateTime
  checkOut       DateTime
  breakTimeStart DateTime
  breakTimeEnd   DateTime
  userId         String               @db.ObjectId
  user           User                 @relation(fields: [userId], references: [id])
  createdAt      DateTime             @default(now())
  updatedAt      DateTime             @updatedAt

  @@index([createdAt])
  @@map("assigned_employees")
}

model Expenses {
  id              String         @id @default(auto()) @map("_id") @db.ObjectId
  category        String
  projectId       String         @db.ObjectId
  project         Project        @relation(fields: [projectId], references: [id])
  amount          Float
  description     String?
  receiptDocImage String?
  status          ExpensesStatus
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt

  @@map("expenses")
}

enum ExpensesStatus {
  PENDING
  APPROVED
  REJECTED
}

enum AssignedEmployeeRole {
  RUNNER
  PICKER
}

enum ProjectStatus {
  STAGING
  WALKTHROUGH
  DESTAGING
  COMPLETED
}

enum UserRole {
  ADMIN
  EMPLOYEE
}

enum UserStatus {
  ACTIVE
  BLOCKED
}
